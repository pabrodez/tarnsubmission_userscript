// ==UserScript==
// @name TARN submission helper
// @version 0.1
// @author pabrodez
// @description Made for the TARN submitter's happiness
// @match https://www.tarn.ac.uk/SubmissionDetail.aspx?subid=*&qsid=*&ro=N&mult=N&QAsub=&ssid=&pt=sect
// @match https://www.tarn.ac.uk/SubmissionDetail.aspx?subid=*&qsid=*&ro=N&mult=N&QAsub=&ssid=*&pt=sect
// @match https://www.tarn.ac.uk/SubmissionDetail.aspx?subid=*&ssid=*&qsid=*&ro=N&mult=N&QAsub=&&pt=sect
// @match https://www.tarn.ac.uk/SubmissionDetail.aspx?subid=*&ssid=*&qsid=*&psid=Null&pt=sect&ro=N&mult=N&QAsub=
// @match https://www.tarn.ac.uk/SubmissionDetail.aspx?subid=*&ssid=*&qsid=*&psid=Null&pt=sect&ro=N&mult=Y&QAsub=
// @match https://www.tarn.ac.uk/SubmissionDetail.aspx?subid=*&ssid=*&qsid=*&psid=0&pt=sect&ro=N&mult=N&QAsub=
// @grant none
// @require https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js
// @license MIT
// ==/UserScript==

!function(e){var t={};function n(E){if(t[E])return t[E].exports;var S=t[E]={i:E,l:!1,exports:{}};return e[E].call(S.exports,S,S.exports,n),S.l=!0,S.exports}n.m=e,n.c=t,n.d=function(e,t,E){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:E})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var E=Object.create(null);if(n.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var S in e)n.d(E,S,function(t){return e[t]}.bind(null,S));return E},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],E=!0,S=!1,o=void 0;try{for(var A,c=e[Symbol.iterator]();!(E=(A=c.next()).done)&&(n.push(A.value),!t||n.length!==t);E=!0);}catch(e){S=!0,o=e}finally{try{E||null==c.return||c.return()}finally{if(S)throw o}}return n}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,E=new Array(t);n<t;n++)E[n]=e[n];return E}!function(){"use strict";var e=document.createElement("aside");e.setAttribute("style","position:fixed; top:50%; right:2%;"),e.id="toolbar",e.appendChild(function(){null===localStorage.getItem("timeToSave")&&localStorage.setItem("timeToSave",5);var e=document.createElement("section");e.innerHTML='<p>Auto-save <span id="timeToSave">'.concat(localStorage.getItem("timeToSave"),"</span>mins</p>");var t=document.createElement("input");t.type="range",t.min=1,t.max=10,t.value=Number(localStorage.getItem("timeToSave")),t.step=1;var n=setTimeout((function(){document.getElementById("btnSave").click()}),6e4*Number(localStorage.getItem("timeToSave")));return t.addEventListener("input",(function(e){document.getElementById("timeToSave").textContent=e.target.value,localStorage.setItem("timeToSave",e.target.value),clearTimeout(n),n=setTimeout((function(){document.getElementById("btnSave").click()}),6e4*Number(localStorage.getItem("timeToSave")))})),e.appendChild(t),e}()),e.appendChild(function(){null===localStorage.getItem("disTimeout")&&localStorage.setItem("disTimeout","no");var e,t=localStorage.getItem("disTimeout"),n=document.createElement("section"),E=document.createElement("input");E.id="disTimeout",E.type="button",E.value="Disable timeout",E.setAttribute("style","no"===t?"background-color:red;":"background-color:green;"),"yes"===t&&(e=setInterval((function(){resetTimer()}),1e4));return E.addEventListener("click",(function(t){localStorage.setItem("disTimeout","no"===localStorage.getItem("disTimeout")?"yes":"no"),t.target.setAttribute("style","no"===localStorage.getItem("disTimeout")?"background-color:red;":"background-color:green;"),"yes"===localStorage.getItem("disTimeout")?e=setInterval((function(){resetTimer()}),1e4):"no"===localStorage.getItem("disTimeout")&&clearInterval(e)})),n.appendChild(E),n}()),document.body.appendChild(e);var t,S=document.querySelector("#mainTable h3 span").innerText.toLowerCase();if("opening section"===S){document.getElementById("A00HOSPITAL_TRANSFER").addEventListener("change",(function(e){["2","4","6"].includes(e.target.value)&&(document.getElementById("transferTimeAlert")||document.getElementById("toolbar").appendChild(function(){var e=document.createElement("section");e.innerHTML='<p id="transferTimeAlert">'.concat(a()?"Transfer on time":"Transfer NOT on time","</p>");var t=document.querySelectorAll('input[id$="ARV_DATE"]:not([name="A00HOSPITAL_ARV_DATE"])'),n=document.querySelectorAll('input[id$="ARV_TIME"]:not([name="A00HOSPITAL_ARV_TIME"])'),S=document.querySelectorAll('input[id$="IN_REQ_DATE"]:not([name="A00TRANS_IN_REQ_DATE"])'),o=document.querySelectorAll('input[id$="IN_REQ_TIME"]:not([name="A00TRANS_IN_REQ_TIME"])');return[].concat(E(t),E(n),E(S),E(o)).forEach((function(e){e.addEventListener("blur",(function(e){document.getElementById("transferTimeAlert").innerText=a()?"Transfer on time":"Transfer NOT on time"}))})),e}()))})),document.getElementById("toolbar").appendChild(((t=document.createElement("section")).innerHTML='<p id="rehabNonBptAlert">'.concat(_()?"Rehab ok":"Rehab NOT ok","</p>"),document.querySelectorAll('[id^="R00REHAB"] input[type="radio"]').forEach((function(e){e.addEventListener("click",(function(e){document.getElementById("rehabNonBptAlert").innerText=_()?"Rehab ok":"Rehab NOT ok"}))})),t)),localStorage.setItem("dateTimeArr",E(document.querySelectorAll("#DHOSPITAL_ARV_DATE, #MHOSPITAL_ARV_DATE, #YHOSPITAL_ARV_DATE, #HHOSPITAL_ARV_TIME, #NHOSPITAL_ARV_TIME")).map((function(e){return e.value})).join("")),localStorage.setItem("patientAge",document.getElementById("A00PATIENT_AGE").value),T("R00COLLECT_TARNCASE","RB0COLLECT_TARNCASE"),T("R00PATIENT_GP_Q","RB0PATIENT_GP_Q");var o=document.querySelectorAll("#R00REHAB_PRESEVAL input[type=radio]");Array.from(o).some((function(e){return e.checked}))||(o[0].click(),document.getElementById("RB0REHAB_PRESNEED").click(),document.getElementById("RB0REHAB_PRESCMPLT").click(),m("A00REHAB_PRESTYPE",1),m("A00REHAB_PRESCMPBYA",4),document.getElementById("RB0REHAB_PRESCOREA").click(),document.getElementById("RB0REHAB_PRESDEVINV").click(),document.getElementById("RB0REHAB_PRESDEVDISC").click(),document.getElementById("RB0REHAB_PRESDEVGVN1").click(),document.getElementById("RB0REHAB_PRESDEVGVN2").click(),document.getElementById("RB0REHAB_PRESDEVGVN3").click(),document.getElementById("RB0REHAB_PRESCHECKS").click(),document.getElementById("RB0REHAB_PRESCHECK1").click(),document.getElementById("RB0REHAB_PRESTRANS").click()),T("RB1REHAB_PRESCRIP_Q","RB1REHAB_PRESCRIP_Q")}if("incident"===S&&(d("R00INCIDENT_DATE","B03INCIDENT_DATE"),T("R00INJURY_TYPE","RB0INJURY_TYPE"),m("A00INJURY_INTENT",1),m("A00INCIDENT_ADD_INF",0),T("R00INJURY_TRAPPED","RB1INJURY_TRAPPED"),T("R00INJURY_EXT_ARREST","RB1INJURY_EXT_ARREST"),T("R00INTER_COAGREV_MAJINC","RB1INTER_COAGREV_MAJINC")),"pre-hospital"===S){document.getElementById("A00INCIDENT_ARV_MODE").addEventListener("change",(function(e){localStorage.setItem("transportMethod",e.target.value)})),m("A00INCIDENT_ARV_MODE",1),T("R00PREHOSP_STAY","RB0PREHOSP_STAY"),T("R00PR_FORM","RB0PR_FORM"),document.getElementById("A00INCIDENT_CAD_NUMBER").value="9999",document.getElementById("RB0INTER_ATTENDANT").addEventListener("click",(function(e){document.getElementById("DATT_ATT_DATE").value=document.getElementById("DINCIDENT_ARV_DATE").value,document.getElementById("MATT_ATT_DATE").value=document.getElementById("MINCIDENT_ARV_DATE").value,document.getElementById("YATT_ATT_DATE").value=document.getElementById("YINCIDENT_ARV_DATE").value,document.getElementById("HATT_ATT_TIME").value=document.getElementById("HINCIDENT_ARV_TIME").value,document.getElementById("NATT_ATT_TIME").value=document.getElementById("NINCIDENT_ARV_TIME").value,m("A00ATT_TYPE",4),m("A00ATT_AMB_SERVICE",1158)})),u(),document.querySelectorAll("#DINCIDENT_ARV_DATE, #MINCIDENT_ARV_DATE, #YINCIDENT_ARV_DATE, #HINCIDENT_ARV_TIME, #NINCIDENT_ARV_TIME").forEach((function(e){e.addEventListener("blur",(function(e){var t,n,E,S,o;t=document.getElementById("DINCIDENT_ARV_DATE").value,n=document.getElementById("MINCIDENT_ARV_DATE").value,E=document.getElementById("YINCIDENT_ARV_DATE").value,document.querySelectorAll('[id^="DASSESS_DATE"]').forEach((function(e){e.value=e.value||t})),document.querySelectorAll('[id^="MASSESS_DATE"]').forEach((function(e){e.value=e.value||n})),document.querySelectorAll('[id^="YASSESS_DATE"]').forEach((function(e){e.value=e.value||E,e.dispatchEvent(new Event("blur"))})),S=document.getElementById("HINCIDENT_ARV_TIME").value,o=document.getElementById("NINCIDENT_ARV_TIME").value,document.querySelectorAll('[id^="HASSESS_TIME"]').forEach((function(e){e.value=e.value||S})),document.querySelectorAll('[id^="NASSESS_TIME"]').forEach((function(e){e.value=e.value||o,e.dispatchEvent(new Event("blur"))}))}))}));var A=document.createElement("input");A.type="button",A.value="No to remaining",A.addEventListener("click",(function(e){r()})),document.getElementById("GROUP6").appendChild(A),l()}if("ed"===S){document.getElementById("toolbar").appendChild(function(){var e=document.createElement("section");e.setAttribute("style","display:flex; flex-direction:column;");var t=document.createElement("textarea");t.id="obsText";var E=document.createElement("input");return E.type="button",E.value="Paste observations",E.addEventListener("click",(function(e){var t=function(e){for(var t={airway:/(?<=airway status:[\s])clear|obstructed|obstruction|intubated|intubation|ett|supported/i,resp:/(?<=(respiratory rate|Respiration rate Resp\/min):[\s])\d{1,2}/i,sat:/(?<=o2 saturation[\s%]*:[\s]?)\d{1,3}/i,pulse:/(?<=(pulse|heart) rate(\sbpm)?:[\s])\d{1,3}(?=\sbpm)/i,bpsys:/(?<=bp systolic(\smmhg)?:[\s])\d{1,3}(?=\s?mmhg)/i,bpdias:/(?<=bp diastolic(\smmhg)?:[\s])\d{1,3}(?=\s?mmhg)/i,cr:/(?<=capillary refill:[\s]?)normal|abnormal/i,gcse:/(?<=(gcs - e|eyes open):[\s]?)\d/i,gcsv:/(?<=(gcs - v|best verbal response):[\s]?)\d/i,gcsm:/(?<=(gcs - m|best motor response):[\s]?)\d/i,gcstotal:/(?<=(gcs - total|gcs score):[\s]?)\d+/i,leftpupsize:/(?<=left pupil size:[\s]?)\d(?= mm)/i,leftpupreact:/(?<=left pupil (response|reaction):[\s])\w+/i,rightpupsize:/(?<=right pupil size:[\s]?)\d(?= mm)/i,rightpupreact:/(?<=right pupil (response|reaction):[\s])\w+/i},E=0,S=Object.entries(t);E<S.length;E++){var o=n(S[E],2),A=o[0],c=o[1],l=e.match(c);t[A]=l?l[0]:""}return t}(document.getElementById("obsText").value);document.getElementById("A00ASSESS_OXIMETER_SAT").value=t.sat,document.getElementById("A00ASSESS_RESP_RATE_VAL").value=t.resp,document.getElementById("A00ASSESS_PULSE_VAL").value=t.pulse,document.getElementById("A00ASSESS_SYSBP_VAL").value=t.bpsys,document.getElementById("A00ASSESS_DIABP_VAL").value=t.bpdias,/normal/i.test(t.cr)&&document.getElementById("RB0ASSESS_CREFILL_NORM").click(),document.getElementById("A00ASSESS_GCS_EYE").value=t.gcse,document.getElementById("A00ASSESS_GCS_VERBAL").value=t.gcsv,document.getElementById("A00ASSESS_GCS_MOTOR").value=t.gcsm,m("A00ASSESS_GCS_TOTAL",t.gcstotal),document.getElementById("A00ASSESS_GCS_LEFT_EYE").value=t.leftpupsize,document.getElementById("A00ASSESS_GCS_RIGHT_EYE").value=t.rightpupsize,/react|brisk|yes/i.test(t.leftpupreact)&&document.getElementById("RB1ASSESS_GCS_RCT_LEFT").click(),/react|brisk|yes/i.test(t.rightpupreact)&&document.getElementById("RB1ASSESS_GCS_RCT_RIGHT").click()})),e.appendChild(t),e.appendChild(E),e}()),document.getElementById("toolbar").appendChild(R()),document.getElementById("toolbar").appendChild(function(){var e=document.createElement("section");return e.innerHTML='<p id="lateIntubationAlert"></p>',document.querySelectorAll('#A00INTER_AIRWAYSUPP, #R00INTER_DATE_AIRSUPP input[type="text"], #R00INTER_TIME_AIRSUPP input[type="text"]').forEach((function(e){e.addEventListener("change",(function(e){var t,n;document.getElementById("lateIntubationAlert").textContent=(t=moment(E(document.querySelectorAll("#DEMERG_ARV_DATE, #MEMERG_ARV_DATE, #YEMERG_ARV_DATE, #HEMERG_ARV_TIME, #NEMERG_ARV_TIME")).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm"),n=moment(E(document.querySelectorAll("#DINTER_DATE_AIRSUPP, #MINTER_DATE_AIRSUPP, #YINTER_DATE_AIRSUPP, #HINTER_TIME_AIRSUPP, #NINTER_TIME_AIRSUPP")).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm"),"3"===document.getElementById("A00INTER_AIRWAYSUPP").value&&n.diff(t,"minutes",!0)<=30?"Intubation is ON TIME":"Intubation is LATE")}))})),e}()),T("R00ED_STAY","RB0ED_STAY"),d("R00EMERG_ARV_DATE","B03EMERG_ARV_DATE"),d("R00EMERG_ARV_TIME","B03EMERG_ARV_TIME"),document.getElementById("B03ASSESS_DATE_RESP").click(),document.getElementById("B03ASSESS_DATE_CIRC").click(),document.getElementById("B03ASSESS_DATE_NSYS").click(),document.querySelectorAll('[id^="DASSESS_DATE"], [id^="MASSESS_DATE"], [id^="YASSESS_DATE"], [id^="HASSESS_TIME"], [id^="NASSESS_TIME"]').forEach((function(e){e.addEventListener("change",(function(e){document.querySelectorAll("[id^=".concat(e.target.id.substr(0,12),"]")).forEach((function(t){t.value||(t.value=e.target.value,t.dispatchEvent(new Event("blur")))}))}))})),u();var c=document.createElement("input");c.type="button",c.value="No to remaining",c.addEventListener("click",(function(e){r(!0)})),document.getElementById("GROUP4").appendChild(c),l()}function l(){document.getElementById("RB0INTER_FLUIDBOLUS").addEventListener("click",(function(e){document.getElementById("B03INTER_DATE_FLUID").click(),document.getElementById("A00INTER_FLUID_BLSTYPE").value=3,document.getElementById("A00INTER_FLUID_VOL").value=1e3})),document.getElementById("RB0INTER_TRANEXAMIC").addEventListener("click",(function(e){document.getElementById("A00INTER_TRANEX_VOL").value=1e3,document.getElementById("toolbar").appendChild(function(){var e=document.createElement("section");return e.innerHTML='<p id="lateTxaAlert">'.concat(i()?"TXA on time":"TXA NOT on time","</p>"),document.querySelectorAll("#DINTER_TRANEX_DATE, #MINTER_TRANEX_DATE, #YINTER_TRANEX_DATE, #HINTER_TRANEX_TIME, #NINTER_TRANEX_TIME").forEach((function(e){e.addEventListener("change",(function(e){document.getElementById("lateTxaAlert").innerText=i()?"TXA on time":"TXA NOT on time"}))})),e}())})),document.getElementById("RB0INTER_SPROT").addEventListener("click",(function(e){document.getElementById("A00INTER_SPROT_TYPE").value=12}))}function u(){T("R00ASSESS_OBS_RESP","RB0ASSESS_OBS_RESP"),T("R00ASSESS_AIRWAYSTATUS","RB0ASSESS_AIRWAYSTATUS"),T("R00ASSESS_BREATHSTATUS","RB0ASSESS_BREATHSTATUS"),T("R00ASSESS_OXIMETER","RB0ASSESS_OXIMETER"),T("R00ASSESS_RESP_RATE","RB0ASSESS_RESP_RATE"),T("R00ASSESS_OBS_CIRC","RB0ASSESS_OBS_CIRC"),T("R00ASSESS_PULSE","RB0ASSESS_PULSE"),T("R00ASSESS_BLOODPRESSURE","RB0ASSESS_BLOODPRESSURE"),T("R00ASSESS_CREFILL","RB0ASSESS_CREFILL"),T("R00ASSESS_OBS_NSYS","RB0ASSESS_OBS_NSYS"),T("R00ASSESS_GCS","RB0ASSESS_GCS"),T("R00ASSESS_GCS_PSIZE","RB0ASSESS_GCS_PSIZE"),T("R00ASSESS_GCS_PUPIL","RB0ASSESS_GCS_PUPIL"),T("R00ASSESS_BSAMP","RB1ASSESS_BSAMP")}function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];T("R00INTER_AIRWAYSUPPORT","RB1INTER_AIRWAYSUPPORT"),T("R00INTER_BREATHSUPP","RB1INTER_BREATHSUPP"),T("R00INTER_THORACOSTOMY","RB1INTER_THORACOSTOMY"),T("R00INTER_SPROT","RB1INTER_SPROT"),T("R00INTER_TRANSFUSION","RB1INTER_TRANSFUSION"),T("R00INTER_FLUIDBOLUS","RB1INTER_FLUIDBOLUS"),T("R00INTER_CDRAIN","RB1INTER_CDRAIN"),T("R00INTER_TRANEXAMIC","RB1INTER_TRANEXAMIC"),T("R00INTER_ANAL","RB1INTER_ANAL"),T("R00INTER_ANTICOAG_REV","RB1INTER_ANTICOAG_REV"),e&&(T("R00INTER_AWS_EXTUB","RB1INTER_AWS_EXTUB"),T("R00INTER_SPROT_REM","RB1INTER_SPROT_REM"),T("R00INTER_EMOB","RB1INTER_EMOB"))}function T(e,t){var n=document.querySelectorAll("#".concat(e," input[type=radio]"));Array.from(n).every((function(e){return!e.checked}))&&document.getElementById(t).click()}function d(e,t){var n=document.querySelectorAll("#"+e+" input[type=text]");Array.from(n).some((function(e){return e.value}))||document.getElementById(t).click()}function m(e,t){var n=document.getElementById(e);""===n.value&&(n.value=t,n.dispatchEvent(new Event("change")))}function i(){var e,t=localStorage.getItem("transportMethod"),n=moment(E(document.querySelectorAll("#DINTER_TRANEX_DATE, #MINTER_TRANEX_DATE, #YINTER_TRANEX_DATE, #HINTER_TRANEX_TIME, #NINTER_TRANEX_TIME")).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm");if(["1","2","9","14"].includes(t)){var S=moment(E(document.querySelectorAll("#DINCIDENT_ARV_DATE, #MINCIDENT_ARV_DATE, #YINCIDENT_ARV_DATE, #HINCIDENT_ARV_TIME, #NINCIDENT_ARV_TIME")).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm");e=n.diff(S,"minutes",!0)<=60}else if(["13","3","6","5"].includes(t)){var o=moment(localStorage.getItem("dateTimeArr"),"DDMMYYYYHHmm");e=n.diff(o,"minutes",!0)<=60}return e}function a(){return['input[id*="IN_REQ"]:not([name="A00TRANS_IN_REQ_DATE"]):not([name="A00TRANS_IN_REQ_TIME"])','input[id*="ARV"]:not([name="A00HOSPITAL_ARV_TIME"]):not([name="A00HOSPITAL_ARV_DATE"])'].map((function(e){return moment(E(document.querySelectorAll(e)).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm")})).reduce((function(e,t){return t.diff(e,"hours",!0)}))<=48}function _(){return!("2"===document.getElementById("A00REHAB_PRESEVAL").value||"3"===document.getElementById("A00REHAB_PRESNEED").value||"2"===document.getElementById("A00REHAB_PRESCMPLT").value||"3"===document.getElementById("A00REHAB_PRESCMPLT").value||"2"===document.getElementById("A00REHAB_PRESCOREA").value||"3"===document.getElementById("A00REHAB_PRESCOREA").value||"2"===document.getElementById("A00REHAB_PRESDEVINV").value||"3"===document.getElementById("A00REHAB_PRESDEVINV").value||"2"===document.getElementById("A00REHAB_PRESDEVDISC").value||"3"===document.getElementById("A00REHAB_PRESDEVDISC").value||"2"===document.getElementById("A00REHAB_PRESDEVGVN1").value||"3"==document.getElementById("A00REHAB_PRESDEVGVN1").value||"2"===document.getElementById("A00REHAB_PRESDEVGVN2").value||"3"===document.getElementById("A00REHAB_PRESDEVGVN2").value||"2"===document.getElementById("A00REHAB_PRESDEVGVN3").value||"3"===document.getElementById("A00REHAB_PRESDEVGVN3").value||"2"===document.getElementById("A00REHAB_PRESCHECKS").value||"3"===document.getElementById("A00REHAB_PRESCHECKS").value)}function R(){var e=document.createElement("section");return e.innerHTML='<p id="lateGcsAlert"></p>',document.querySelectorAll('#A00ASSESS_GCS_TOTAL, #R00ASSESS_DATE_NSYS input[type="text"], #R00ASSESS_TIME_NSYS input[type="text"]').forEach((function(e){e.addEventListener("change",(function(e){var t,n;document.getElementById("lateGcsAlert").textContent=(t=moment(localStorage.getItem("dateTimeArr"),"DDMMYYYYHHmm"),n=moment(E(document.querySelectorAll("#DASSESS_DATE_NSYS, #MASSESS_DATE_NSYS, #YASSESS_DATE_NSYS, #HASSESS_TIME_NSYS, #NASSESS_TIME_NSYS")).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm"),document.getElementById("A00ASSESS_GCS_TOTAL")&&n.diff(t,"minutes",!0)<=30?"GCS is ON TIME":"GCS is LATE")}))})),e}"ed attendants"===S&&document.getElementById("RB0INTER_ATTENDANT").addEventListener("click",(function(e){document.getElementById("B03ATT_ATT_DATE").click(),m("A00ATT_TYPE",1),m("A00ATT_GRADE",1),m("A00ATT_SPECIALITY",1),m("A00ATT_TRAINING",16)})),"imaging"===S&&(document.getElementById("RB0ASSESS_CTSCAN").addEventListener("click",(function(e){document.getElementById("B03ASSESS_DATE_CT").click(),m("A00ASSESS_CTS_TRANSFER",5),document.getElementById("RB0ASSESS_CTS_FRSRPT").click(),document.getElementById("RB0ASSESS_CTS_REVIEW").click(),m("A00ASSESS_CTS_REV_GRADE",1)})),document.getElementById("toolbar").appendChild(function(){var e=document.createElement("section");return e.innerHTML='<p id="lateCtAlert"></p>',document.querySelectorAll("#DASSESS_DATE_CT, #MASSESS_DATE_CT, #YASSESS_DATE_CT, #HASSESS_TIME_CT, #NASSESS_TIME_CT").forEach((function(e){e.addEventListener("change",(function(e){var t;document.getElementById("lateCtAlert").textContent=(t=moment(localStorage.getItem("dateTimeArr"),"DDMMYYYYHHmm"),moment(E(document.querySelectorAll("#DASSESS_DATE_CT, #MASSESS_DATE_CT, #YASSESS_DATE_CT, #HASSESS_TIME_CT, #NASSESS_TIME_CT")).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm").diff(t,"minutes",!0)<=60?"CT is ON TIME":"CT is LATE")}))})),e}())),"critical care"===S&&(document.getElementById("RB0CCARE_STAY").addEventListener("click",(function(e){m("A00CCARE_UNIT_TYPE",4),document.getElementById("RB1CCARE_READMIT").click();document.querySelectorAll('[id^="R00ASSESS_OBS"][style=""]'),document.querySelectorAll('[id^="R00INTER"][style=""]'),document.getElementById("R00ASSESS_BSAMP");[].concat(E(document.querySelectorAll('input[id^="RB1ASSESS_OBS"]')),[document.getElementById("RB1ASSESS_BSAMP")],E(document.querySelectorAll('input[id^="RB1INTER"]'))).forEach((function(e){e.click()}))})),document.getElementById("RB0ASSESS_OBS_NSYS").addEventListener("click",(function(e){document.getElementById("toolbar").appendChild(R())}))),"cc attendants"===S&&document.getElementById("RB0INTER_ATTENDANT").addEventListener("click",(function(e){d("R00ATT_ATT_DATE","B03ATT_ATT_DATE"),m("A00ATT_TYPE",1),m("A00ATT_GRADE",1),m("A00ATT_SPECIALITY",5),m("A00ATT_TRAINING",14)})),"at discharge"===S&&(document.getElementById("A00INJURY_DESCRIPTION").value=document.getElementById("A00INJURY_DESCRIPTION").value||"Source: imaging reports and clinical notes",Number(localStorage.getItem("patientAge"))<65?T("R00OUT_PATASSESS","RB1OUT_PATASSESS"):(T("R00OUT_PATASSESS","RB0OUT_PATASSESS"),m("A00OUT_PATASS_GRADE",1),m("A00OUT_PATASS_SPEC",4),document.getElementById("toolbar").appendChild(function(){var e=document.createElement("section");return e.innerHTML='<p><span id="incorrectCfsAlert"></span>CFS</p>',document.querySelectorAll("#DOUT_PATASS_DATE, #MOUT_PATASS_DATE, #YOUT_PATASS_DATE, #HOUT_PATASS_TIME, #NOUT_PATASS_TIME, #A00OUT_PATASS_GRADE, #A00OUT_PATASS_SPEC").forEach((function(e){e.addEventListener("change",(function(e){var t,n,S,o;document.getElementById("incorrectCfsAlert").textContent=(t=moment(localStorage.getItem("dateTimeArr"),"DDMMYYYYHHmm"),n=moment(E(document.querySelectorAll("#DOUT_PATASS_DATE, #MOUT_PATASS_DATE, #YOUT_PATASS_DATE, #HOUT_PATASS_TIME, #NOUT_PATASS_TIME")).map((function(e){return e.value})).join(""),"DDMMYYYYHHmm"),S="1"===document.getElementById("A00OUT_PATASS_GRADE").value,o="4"===document.getElementById("A00OUT_PATASS_SPEC").value,S&&o&&n.diff(t,"hours",!0)<=72?"👌":"❌")}))})),e}())),document.getElementById("A00OUT_PRE_DISEASE").addEventListener("change",(function(e){"998"===e.target.value&&(document.getElementById("RB1OUT_ANTICOAG_PRE").click(),document.getElementById("RB1OUT_ANTIPLATE_PRE").click())})),T("R00OUT_DIS_STATUS","RB0OUT_DIS_STATUS"),document.getElementById("RB1OUT_DIS_STATUS").addEventListener("click",(function(e){document.getElementById("A00OUT_DIS_DEST").value=3,document.getElementById("A00OUT_GOS").value=1})),T("R00OUT_DIS_SELF","RB1OUT_DIS_SELF"),m("A00OUT_GOS_GENERICTIME",1),T("R00OUT_READM","RB1OUT_READM"))}()}]);